{"version":3,"sources":["BottomSheet.tsx"],"names":["React","useState","useMemo","useRef","useCallback","forwardRef","useImperativeHandle","memo","useLayoutEffect","useEffect","invariant","Animated","useAnimatedReaction","useSharedValue","useAnimatedStyle","useDerivedValue","runOnJS","interpolate","Extrapolate","runOnUI","cancelAnimation","useWorkletCallback","State","useInteractivePanGestureHandler","useScrollable","usePropsValidator","useNormalizedSnapPoints","useReactiveSharedValue","useKeyboard","BottomSheetInternalProvider","BottomSheetProvider","BottomSheetContainer","BottomSheetBackdropContainer","BottomSheetHandleContainer","BottomSheetBackgroundContainer","BottomSheetDraggableView","GESTURE","ANIMATION_STATE","WINDOW_HEIGHT","KEYBOARD_STATE","KEYBOARD_BEHAVIOR","SHEET_STATE","SCROLLABLE_STATE","KEYBOARD_BLUR_BEHAVIOR","animate","getKeyboardAnimationConfigs","DEFAULT_ANIMATION_EASING","DEFAULT_ANIMATION_DURATION","DEFAULT_HANDLE_HEIGHT","DEFAULT_OVER_DRAG_RESISTANCE_FACTOR","DEFAULT_ENABLE_CONTENT_PANNING_GESTURE","DEFAULT_ENABLE_HANDLE_PANNING_GESTURE","DEFAULT_ENABLE_OVER_DRAG","DEFAULT_ENABLE_FLASH_SCROLLABLE_INDICATOR_ON_EXPAND","DEFAULT_ANIMATE_ON_MOUNT","DEFAULT_KEYBOARD_BEHAVIOR","DEFAULT_KEYBOARD_BLUR_BEHAVIOR","styles","addWhitelistedUIProps","decelerationRate","BottomSheetComponent","props","ref","animationDuration","_providedAnimationDuration","animationEasing","_providedAnimationEasing","animationConfigs","_providedAnimationConfigs","index","_providedIndex","snapPoints","_providedSnapPoints","animateOnMount","enableContentPanningGesture","enableHandlePanningGesture","enableOverDrag","enableFlashScrollableIndicatorOnExpand","style","_providedStyle","keyboardBehavior","keyboardBlurBehavior","handleHeight","_providedHandleHeight","containerHeight","_providedContainerHeight","topInset","overDragResistanceFactor","animatedPosition","_providedAnimatedPosition","animatedIndex","_providedAnimatedIndex","simultaneousHandlers","_providedSimultaneousHandlers","waitFor","_providedWaitFor","activeOffsetX","_providedActiveOffsetX","activeOffsetY","_providedActiveOffsetY","failOffsetX","_providedFailOffsetX","failOffsetY","_providedFailOffsetY","onChange","_providedOnChange","onAnimate","_providedOnAnimate","handleComponent","backdropComponent","backgroundComponent","children","setContainerHeight","setHandleHeight","safeHandleHeight","safeContainerHeight","shouldMeasureContainerHeight","undefined","shouldMeasureHandleHeight","didSetHandleHeight","didSetContainerHeight","isLayoutCalculated","current","currentIndexRef","isClosing","didMountOnAnimate","scrollableContentOffsetY","setScrollableRef","removeScrollableRef","flashScrollableIndicators","isExtendedByKeyboard","animatedKeyboardOffset","state","keyboardState","height","keyboardHeight","keyboardAnimationDuration","keyboardAnimationEasing","shouldHandleKeyboardEvents","sheetHeight","length","initialPosition","refreshUIElements","currentPositionIndex","Math","max","handleOnChange","handleOnAnimate","toPoint","toIndex","findIndex","item","handleSettingScrollableRef","scrollableRef","animatedSheetHeight","none","extend","fullScreen","value","interactive","safeFullScreenSheetHeight","sheetWithKeyboardHeight","SHOWN","animationState","UNDETERMINED","animatedSnapPoints","adjustedSnapPoints","slice","reverse","adjustedSnapPointsIndexes","map","_","push","CLAMP","animatedSheetState","extendedSheetPosition","extendedSheetWithKeyboardPosition","CLOSED","EXTENDED","FULL_SCREEN","OVER_EXTENDED","OPENED","animatedCurrentIndex","animateToPointCompleted","STOPPED","animateToPoint","point","velocity","configs","RUNNING","duration","easing","scrollableState","UNLOCKED","LOCKED","contentPanGestureHandler","contentPanGestureState","type","CONTENT","handlePanGestureHandler","handlePanGestureState","HANDLE","handleOnContainerMeasureHeight","handleOnHandleMeasureHeight","handleSnapTo","newSnapPoint","handleClose","handleExpand","handleCollapse","snapTo","expand","collapse","close","internalContextVariables","snapPointsCount","externalContextVariables","containerAnimatedStyle","opacity","transform","translateY","containerStyle","container","contentContainerAnimatedStyle","contentContainerStyle","contentContainer","contentMaskContainerStyle","contentMaskContainer","paddingBottom","requestAnimationFrame","safeCurrentIndex","min","previousState","restore","HIDDEN","ACTIVE","_animatedIndex","_animatedPosition","_animationState","_contentGestureState","_handleGestureState","END","BottomSheet","displayName"],"mappings":"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","sourcesContent":["import React, {\n  useState,\n  useMemo,\n  useRef,\n  useCallback,\n  forwardRef,\n  useImperativeHandle,\n  memo,\n  useLayoutEffect,\n  useEffect,\n} from 'react';\nimport { ViewStyle } from 'react-native';\nimport invariant from 'invariant';\nimport Animated, {\n  useAnimatedReaction,\n  useSharedValue,\n  useAnimatedStyle,\n  useDerivedValue,\n  runOnJS,\n  interpolate,\n  Extrapolate,\n  runOnUI,\n  cancelAnimation,\n  useWorkletCallback,\n} from 'react-native-reanimated';\nimport { State } from 'react-native-gesture-handler';\nimport {\n  useInteractivePanGestureHandler,\n  useScrollable,\n  usePropsValidator,\n  useNormalizedSnapPoints,\n  useReactiveSharedValue,\n  useKeyboard,\n} from '../../hooks';\nimport {\n  BottomSheetInternalProvider,\n  BottomSheetProvider,\n} from '../../contexts';\nimport BottomSheetContainer from '../bottomSheetContainer';\nimport BottomSheetBackdropContainer from '../bottomSheetBackdropContainer';\nimport BottomSheetHandleContainer from '../bottomSheetHandleContainer';\nimport BottomSheetBackgroundContainer from '../bottomSheetBackgroundContainer';\nimport BottomSheetDraggableView from '../bottomSheetDraggableView';\n// import BottomSheetDebugView from '../bottomSheetDebugView';\nimport {\n  GESTURE,\n  ANIMATION_STATE,\n  WINDOW_HEIGHT,\n  KEYBOARD_STATE,\n  KEYBOARD_BEHAVIOR,\n  SHEET_STATE,\n  SCROLLABLE_STATE,\n  KEYBOARD_BLUR_BEHAVIOR,\n} from '../../constants';\nimport { animate, getKeyboardAnimationConfigs } from '../../utilities';\nimport {\n  DEFAULT_ANIMATION_EASING,\n  DEFAULT_ANIMATION_DURATION,\n  DEFAULT_HANDLE_HEIGHT,\n  DEFAULT_OVER_DRAG_RESISTANCE_FACTOR,\n  DEFAULT_ENABLE_CONTENT_PANNING_GESTURE,\n  DEFAULT_ENABLE_HANDLE_PANNING_GESTURE,\n  DEFAULT_ENABLE_OVER_DRAG,\n  DEFAULT_ENABLE_FLASH_SCROLLABLE_INDICATOR_ON_EXPAND,\n  DEFAULT_ANIMATE_ON_MOUNT,\n  DEFAULT_KEYBOARD_BEHAVIOR,\n  DEFAULT_KEYBOARD_BLUR_BEHAVIOR,\n} from './constants';\nimport type { ScrollableRef, BottomSheetMethods } from '../../types';\nimport type { BottomSheetProps } from './types';\nimport { styles } from './styles';\n\nAnimated.addWhitelistedUIProps({\n  decelerationRate: true,\n});\n\ntype BottomSheet = BottomSheetMethods;\n\nconst BottomSheetComponent = forwardRef<BottomSheet, BottomSheetProps>(\n  (props, ref) => {\n    //#region validate props\n    usePropsValidator(props);\n    //#endregion\n\n    //#region extract props\n    const {\n      // animations configurations\n      animationDuration: _providedAnimationDuration = DEFAULT_ANIMATION_DURATION,\n      animationEasing: _providedAnimationEasing = DEFAULT_ANIMATION_EASING,\n      animationConfigs: _providedAnimationConfigs,\n\n      // configurations\n      index: _providedIndex = 0,\n      snapPoints: _providedSnapPoints,\n      animateOnMount = DEFAULT_ANIMATE_ON_MOUNT,\n      enableContentPanningGesture = DEFAULT_ENABLE_CONTENT_PANNING_GESTURE,\n      enableHandlePanningGesture = DEFAULT_ENABLE_HANDLE_PANNING_GESTURE,\n      enableOverDrag = DEFAULT_ENABLE_OVER_DRAG,\n      enableFlashScrollableIndicatorOnExpand = DEFAULT_ENABLE_FLASH_SCROLLABLE_INDICATOR_ON_EXPAND,\n      style: _providedStyle,\n\n      // keyboard\n      keyboardBehavior = DEFAULT_KEYBOARD_BEHAVIOR,\n      keyboardBlurBehavior = DEFAULT_KEYBOARD_BLUR_BEHAVIOR,\n\n      // layout\n      handleHeight: _providedHandleHeight,\n      containerHeight: _providedContainerHeight,\n      topInset = 0,\n      overDragResistanceFactor = DEFAULT_OVER_DRAG_RESISTANCE_FACTOR,\n\n      // animated callback shared values\n      animatedPosition: _providedAnimatedPosition,\n      animatedIndex: _providedAnimatedIndex,\n\n      // gestures\n      simultaneousHandlers: _providedSimultaneousHandlers,\n      waitFor: _providedWaitFor,\n      activeOffsetX: _providedActiveOffsetX,\n      activeOffsetY: _providedActiveOffsetY,\n      failOffsetX: _providedFailOffsetX,\n      failOffsetY: _providedFailOffsetY,\n\n      // callbacks\n      onChange: _providedOnChange,\n      onAnimate: _providedOnAnimate,\n      // components\n      handleComponent,\n      backdropComponent,\n      backgroundComponent,\n      children,\n    } = props;\n    //#endregion\n\n    //#region layout variables\n    // state\n    const [containerHeight, setContainerHeight] = useState(\n      _providedContainerHeight\n    );\n    const [handleHeight, setHandleHeight] = useState(_providedHandleHeight);\n\n    // safe layout values\n    const safeHandleHeight = useMemo(\n      () =>\n        handleComponent === null ? 0 : handleHeight || DEFAULT_HANDLE_HEIGHT,\n      [handleHeight, handleComponent]\n    );\n    const safeContainerHeight = useMemo(\n      () => _providedContainerHeight || containerHeight || WINDOW_HEIGHT,\n      [_providedContainerHeight, containerHeight]\n    );\n\n    // conditions\n    const shouldMeasureContainerHeight = useMemo(\n      () => _providedContainerHeight === undefined,\n      [_providedContainerHeight]\n    );\n    const shouldMeasureHandleHeight = useMemo(\n      () =>\n        _providedHandleHeight === undefined &&\n        handleComponent !== undefined &&\n        handleComponent !== null,\n      [_providedHandleHeight, handleComponent]\n    );\n\n    // refs\n    const didSetHandleHeight = useRef(!shouldMeasureHandleHeight);\n    const didSetContainerHeight = useRef(!shouldMeasureContainerHeight);\n\n    const isLayoutCalculated = useMemo(\n      () => {\n        return didSetHandleHeight.current && didSetContainerHeight.current;\n      },\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [containerHeight, handleHeight]\n    );\n    //#endregion\n\n    //#region variables\n    const currentIndexRef = useRef<number>(\n      animateOnMount ? -1 : _providedIndex\n    );\n    const isClosing = useRef(false);\n    const didMountOnAnimate = useRef(false);\n\n    // scrollable variables\n    const {\n      scrollableContentOffsetY,\n      setScrollableRef,\n      removeScrollableRef,\n      flashScrollableIndicators,\n    } = useScrollable();\n\n    // keyboard\n    const isExtendedByKeyboard = useSharedValue(false);\n    const animatedKeyboardOffset = useSharedValue(0);\n    const {\n      state: keyboardState,\n      height: keyboardHeight,\n      animationDuration: keyboardAnimationDuration,\n      animationEasing: keyboardAnimationEasing,\n      shouldHandleKeyboardEvents,\n    } = useKeyboard();\n\n    // normalize snap points\n    const snapPoints = useNormalizedSnapPoints(\n      _providedSnapPoints,\n      topInset,\n      safeContainerHeight,\n      safeHandleHeight\n    );\n    const sheetHeight = useMemo(\n      () =>\n        safeContainerHeight -\n        snapPoints[snapPoints.length - 1] -\n        safeHandleHeight,\n      [snapPoints, safeContainerHeight, safeHandleHeight]\n    );\n\n    const initialPosition = useMemo(() => {\n      return currentIndexRef.current < 0 || animateOnMount\n        ? safeContainerHeight - topInset\n        : snapPoints[currentIndexRef.current];\n    }, [snapPoints, animateOnMount, safeContainerHeight, topInset]);\n\n    //#endregion\n\n    //#region private methods\n    const refreshUIElements = useCallback(() => {\n      const currentPositionIndex = Math.max(currentIndexRef.current, 0);\n\n      if (\n        enableFlashScrollableIndicatorOnExpand &&\n        currentPositionIndex === snapPoints.length - 1\n      ) {\n        flashScrollableIndicators();\n      }\n    }, [\n      snapPoints,\n      flashScrollableIndicators,\n      enableFlashScrollableIndicatorOnExpand,\n    ]);\n    const handleOnChange = useCallback(\n      (index: number) => {\n        if (index === currentIndexRef.current) {\n          return;\n        }\n        currentIndexRef.current = index;\n\n        if (isClosing.current && (index === 0 || index === -1)) {\n          isClosing.current = false;\n        }\n\n        if (_providedOnChange) {\n          /**\n           * to avoid having -0 ðŸ¤·â€â™‚ï¸\n           */\n          _providedOnChange(index + 1 - 1);\n        }\n      },\n      [_providedOnChange]\n    );\n    const handleOnAnimate = useCallback(\n      (toPoint: number) => {\n        if (!_providedOnAnimate) {\n          return;\n        }\n        const toIndex = snapPoints.findIndex(item => item === toPoint);\n        if (toIndex !== currentIndexRef.current) {\n          _providedOnAnimate(currentIndexRef.current, toIndex);\n        }\n      },\n      [_providedOnAnimate, snapPoints]\n    );\n    const handleSettingScrollableRef = useCallback(\n      (scrollableRef: ScrollableRef) => {\n        setScrollableRef(scrollableRef);\n        refreshUIElements();\n      },\n      [setScrollableRef, refreshUIElements]\n    );\n    //#endregion\n\n    //#region gesture interaction / animation\n    // variables\n    const animatedSheetHeight = useDerivedValue(() => {\n      if (\n        keyboardBehavior === KEYBOARD_BEHAVIOR.none ||\n        keyboardBehavior === KEYBOARD_BEHAVIOR.extend\n      ) {\n        return sheetHeight;\n      }\n\n      if (keyboardBehavior === KEYBOARD_BEHAVIOR.fullScreen) {\n        return isExtendedByKeyboard.value\n          ? safeContainerHeight - topInset - safeHandleHeight\n          : sheetHeight;\n      }\n\n      if (\n        keyboardBehavior === KEYBOARD_BEHAVIOR.interactive &&\n        isExtendedByKeyboard.value\n      ) {\n        const safeFullScreenSheetHeight =\n          safeContainerHeight - topInset - safeHandleHeight;\n        const sheetWithKeyboardHeight = sheetHeight + keyboardHeight.value;\n\n        if (keyboardState.value === KEYBOARD_STATE.SHOWN) {\n          if (sheetHeight >= safeFullScreenSheetHeight) {\n            return safeFullScreenSheetHeight - keyboardHeight.value;\n          }\n          return sheetHeight;\n        }\n\n        if (sheetWithKeyboardHeight > safeFullScreenSheetHeight) {\n          return safeFullScreenSheetHeight;\n        }\n\n        return sheetWithKeyboardHeight;\n      }\n\n      return sheetHeight;\n    });\n    const animationState = useSharedValue(ANIMATION_STATE.UNDETERMINED);\n    const animatedSnapPoints = useReactiveSharedValue(snapPoints);\n    const animatedPosition = useSharedValue(initialPosition);\n    const animatedIndex = useDerivedValue(() => {\n      const adjustedSnapPoints = snapPoints.slice().reverse();\n      const adjustedSnapPointsIndexes = snapPoints\n        .slice()\n        .map((_, index) => index)\n        .reverse();\n\n      /**\n       * we add the close state index `-1`\n       */\n      adjustedSnapPoints.push(safeContainerHeight);\n      adjustedSnapPointsIndexes.push(-1);\n\n      return isLayoutCalculated\n        ? interpolate(\n            animatedPosition.value,\n            adjustedSnapPoints,\n            adjustedSnapPointsIndexes,\n            Extrapolate.CLAMP\n          )\n        : -1;\n    }, [snapPoints, safeContainerHeight, isLayoutCalculated]);\n    const animatedSheetState = useDerivedValue(() => {\n      const extendedSheetPosition =\n        safeContainerHeight - safeHandleHeight - sheetHeight;\n      const extendedSheetWithKeyboardPosition =\n        safeContainerHeight -\n        safeHandleHeight -\n        sheetHeight -\n        keyboardHeight.value;\n\n      if (animatedPosition.value >= safeContainerHeight) {\n        return SHEET_STATE.CLOSED;\n      } else if (\n        animatedPosition.value === extendedSheetPosition ||\n        (keyboardBehavior === KEYBOARD_BEHAVIOR.interactive &&\n          isExtendedByKeyboard.value &&\n          animatedPosition.value === extendedSheetWithKeyboardPosition)\n      ) {\n        return SHEET_STATE.EXTENDED;\n      } else if (animatedPosition.value === topInset) {\n        return SHEET_STATE.FULL_SCREEN;\n      } else if (animatedPosition.value < extendedSheetPosition) {\n        return SHEET_STATE.OVER_EXTENDED;\n      }\n\n      return SHEET_STATE.OPENED;\n    });\n    const animatedCurrentIndex = useSharedValue(currentIndexRef.current);\n\n    // callbacks\n    const animateToPointCompleted = useWorkletCallback(() => {\n      animationState.value = ANIMATION_STATE.STOPPED;\n    });\n    const animateToPoint = useWorkletCallback(\n      (\n        point: number,\n        velocity: number = 0,\n        configs?: Animated.WithTimingConfig | Animated.WithSpringConfig\n      ) => {\n        /**\n         * cancel current running animation\n         */\n        cancelAnimation(animatedPosition);\n\n        /**\n         * set animation state to running\n         */\n        animationState.value = ANIMATION_STATE.RUNNING;\n\n        /**\n         * fire `onAnimate` callback\n         */\n        runOnJS(handleOnAnimate)(point);\n\n        /**\n         * force animation configs from parameters, if provided\n         */\n        if (configs !== undefined) {\n          animatedPosition.value = animate(\n            point,\n            configs,\n            velocity,\n            animateToPointCompleted\n          );\n        } else if (_providedAnimationConfigs) {\n          /**\n           * use animationConfigs callback, if provided\n           */\n          animatedPosition.value = animate(\n            point,\n            _providedAnimationConfigs,\n            velocity,\n            animateToPointCompleted\n          );\n        } else {\n          animatedPosition.value = animate(\n            point,\n            {\n              duration: _providedAnimationDuration,\n              easing: _providedAnimationEasing,\n            },\n            0,\n            animateToPointCompleted\n          );\n        }\n      },\n      [\n        handleOnAnimate,\n        _providedAnimationConfigs,\n        _providedAnimationDuration,\n        _providedAnimationEasing,\n      ]\n    );\n\n    const scrollableState = useDerivedValue(() => {\n      return animatedSheetState.value === SHEET_STATE.FULL_SCREEN ||\n        animatedSheetState.value === SHEET_STATE.EXTENDED\n        ? SCROLLABLE_STATE.UNLOCKED\n        : SCROLLABLE_STATE.LOCKED;\n    });\n\n    // hooks\n    const [\n      contentPanGestureHandler,\n      contentPanGestureState,\n    ] = useInteractivePanGestureHandler({\n      type: GESTURE.CONTENT,\n      enableOverDrag,\n      overDragResistanceFactor,\n      keyboardState,\n      keyboardHeight,\n      keyboardBehavior: keyboardBehavior,\n      animatedPosition,\n      animatedSnapPoints,\n      isExtendedByKeyboard,\n      scrollableContentOffsetY,\n      animateToPoint,\n    });\n\n    const [\n      handlePanGestureHandler,\n      handlePanGestureState,\n    ] = useInteractivePanGestureHandler({\n      type: GESTURE.HANDLE,\n      enableOverDrag,\n      overDragResistanceFactor,\n      keyboardState,\n      keyboardHeight,\n      keyboardBehavior,\n      animatedPosition,\n      animatedSnapPoints,\n      isExtendedByKeyboard,\n      animateToPoint,\n    });\n    //#endregion\n\n    //#region layout callbacks\n    const handleOnContainerMeasureHeight = useCallback((height: number) => {\n      // console.log('BottomSheet', 'handleOnContainerMeasureHeight', height);\n      didSetContainerHeight.current = true;\n      setContainerHeight(height);\n    }, []);\n\n    const handleOnHandleMeasureHeight = useCallback((height: number) => {\n      // console.log('BottomSheet', 'handleOnHandleMeasureHeight', height);\n      didSetHandleHeight.current = true;\n      setHandleHeight(height);\n    }, []);\n    //#endregion\n\n    //#region public methods\n    const handleSnapTo = useCallback(\n      (\n        index: number,\n        animationDuration: number = DEFAULT_ANIMATION_DURATION,\n        animationEasing: Animated.EasingFunction = DEFAULT_ANIMATION_EASING\n      ) => {\n        invariant(\n          index >= -1 && index <= snapPoints.length - 1,\n          `'index' was provided but out of the provided snap points range! expected value to be between -1, ${\n            snapPoints.length - 1\n          }`\n        );\n\n        /**\n         * verify if sheet is closed.\n         */\n        if (animatedPosition.value === safeContainerHeight) {\n          isClosing.current = false;\n        }\n\n        /**\n         * exit method if sheet is closing.\n         */\n        if (isClosing.current) {\n          return;\n        }\n\n        const newSnapPoint = snapPoints[index];\n        runOnUI(animateToPoint)(newSnapPoint, 0, {\n          duration: animationDuration,\n          easing: animationEasing,\n        });\n      },\n      [animateToPoint, snapPoints, safeContainerHeight, animatedPosition]\n    );\n    const handleClose = useCallback(\n      (\n        animationDuration: number = DEFAULT_ANIMATION_DURATION,\n        animationEasing: Animated.EasingFunction = DEFAULT_ANIMATION_EASING\n      ) => {\n        /**\n         * verify if sheet is closed.\n         */\n        if (animatedPosition.value === safeContainerHeight) {\n          isClosing.current = false;\n        }\n\n        /**\n         * exit method if sheet is closing.\n         */\n        if (isClosing.current) {\n          return;\n        }\n\n        isClosing.current = true;\n        runOnUI(animateToPoint)(safeContainerHeight, 0, {\n          duration: animationDuration,\n          easing: animationEasing,\n        });\n      },\n      [animateToPoint, safeContainerHeight, animatedPosition]\n    );\n    const handleExpand = useCallback(\n      (\n        animationDuration: number = DEFAULT_ANIMATION_DURATION,\n        animationEasing: Animated.EasingFunction = DEFAULT_ANIMATION_EASING\n      ) => {\n        /**\n         * verify if sheet is closed.\n         */\n        if (animatedPosition.value === safeContainerHeight) {\n          isClosing.current = false;\n        }\n\n        /**\n         * exit method if sheet is closing.\n         */\n        if (isClosing.current) {\n          return;\n        }\n\n        const newSnapPoint = snapPoints[snapPoints.length - 1];\n        runOnUI(animateToPoint)(newSnapPoint, 0, {\n          duration: animationDuration,\n          easing: animationEasing,\n        });\n      },\n      [animateToPoint, snapPoints, safeContainerHeight, animatedPosition]\n    );\n    const handleCollapse = useCallback(\n      (\n        animationDuration: number = DEFAULT_ANIMATION_DURATION,\n        animationEasing: Animated.EasingFunction = DEFAULT_ANIMATION_EASING\n      ) => {\n        /**\n         * verify if sheet is closed.\n         */\n        if (animatedPosition.value === safeContainerHeight) {\n          isClosing.current = false;\n        }\n\n        /**\n         * exit method if sheet is closing.\n         */\n        if (isClosing.current) {\n          return;\n        }\n\n        const newSnapPoint = snapPoints[0];\n        runOnUI(animateToPoint)(newSnapPoint, 0, {\n          duration: animationDuration,\n          easing: animationEasing,\n        });\n      },\n      [animateToPoint, snapPoints, safeContainerHeight, animatedPosition]\n    );\n\n    useImperativeHandle(ref, () => ({\n      snapTo: handleSnapTo,\n      expand: handleExpand,\n      collapse: handleCollapse,\n      close: handleClose,\n    }));\n    //#endregion\n\n    //#region contexts variables\n    const internalContextVariables = useMemo(\n      () => ({\n        enableContentPanningGesture,\n        snapPointsCount: snapPoints.length,\n        animatedIndex,\n        animatedPosition,\n        animationState,\n        animatedSheetState,\n        contentPanGestureHandler,\n        scrollableState,\n        scrollableContentOffsetY,\n        shouldHandleKeyboardEvents,\n        simultaneousHandlers: _providedSimultaneousHandlers,\n        waitFor: _providedWaitFor,\n        activeOffsetX: _providedActiveOffsetX,\n        activeOffsetY: _providedActiveOffsetY,\n        failOffsetX: _providedFailOffsetX,\n        failOffsetY: _providedFailOffsetY,\n        setScrollableRef: handleSettingScrollableRef,\n        removeScrollableRef,\n      }),\n      [\n        snapPoints.length,\n        animatedIndex,\n        animatedPosition,\n        animationState,\n        animatedSheetState,\n        contentPanGestureHandler,\n        handleSettingScrollableRef,\n        removeScrollableRef,\n        shouldHandleKeyboardEvents,\n        scrollableState,\n        scrollableContentOffsetY,\n        enableContentPanningGesture,\n        _providedSimultaneousHandlers,\n        _providedWaitFor,\n        _providedActiveOffsetX,\n        _providedActiveOffsetY,\n        _providedFailOffsetX,\n        _providedFailOffsetY,\n      ]\n    );\n    const externalContextVariables = useMemo(\n      () => ({\n        snapTo: handleSnapTo,\n        expand: handleExpand,\n        collapse: handleCollapse,\n        close: handleClose,\n      }),\n      [handleSnapTo, handleExpand, handleCollapse, handleClose]\n    );\n    //#endregion\n\n    //#region styles\n    const containerAnimatedStyle = useAnimatedStyle(() => {\n      return {\n        opacity: isLayoutCalculated ? 1 : 0,\n        transform: [\n          {\n            translateY: isLayoutCalculated\n              ? Math.max(\n                  animatedPosition.value + animatedKeyboardOffset.value,\n                  topInset\n                )\n              : safeContainerHeight,\n          },\n        ],\n      };\n    }, [\n      safeContainerHeight,\n      isLayoutCalculated,\n      animatedKeyboardOffset,\n      topInset,\n    ]);\n    const containerStyle = useMemo(\n      () => [_providedStyle, styles.container, containerAnimatedStyle],\n      [_providedStyle, containerAnimatedStyle]\n    );\n    const contentContainerAnimatedStyle = useAnimatedStyle(\n      () => ({\n        height: animatedSheetHeight.value,\n      }),\n      []\n    );\n    const contentContainerStyle = useMemo(\n      () => [styles.contentContainer, contentContainerAnimatedStyle],\n      [contentContainerAnimatedStyle]\n    );\n\n    /**\n     * added safe area to prevent the sheet from floating above\n     * the bottom of the screen, when sheet being over dragged or\n     * when the sheet is resized.\n     */\n    const contentMaskContainerStyle = useMemo<ViewStyle>(\n      () => ({\n        ...styles.contentMaskContainer,\n        paddingBottom: sheetHeight,\n      }),\n      [sheetHeight]\n    );\n    //#endregion\n\n    //#region effects\n    /**\n     * This will animate the sheet to the initial snap point\n     * when component is mounted.\n     */\n    useLayoutEffect(() => {\n      if (\n        animateOnMount &&\n        isLayoutCalculated &&\n        didMountOnAnimate.current === false &&\n        isClosing.current === false &&\n        snapPoints[_providedIndex] !== safeContainerHeight &&\n        _providedIndex !== -1\n      ) {\n        const newSnapPoint = snapPoints[_providedIndex];\n        requestAnimationFrame(() => runOnUI(animateToPoint)(newSnapPoint));\n        didMountOnAnimate.current = true;\n      }\n    }, [\n      _providedIndex,\n      animateOnMount,\n      isLayoutCalculated,\n      snapPoints,\n      safeContainerHeight,\n      animateToPoint,\n    ]);\n\n    /*\n     * keep animated position synced with snap points.\n     */\n    useEffect(() => {\n      if (\n        isLayoutCalculated &&\n        currentIndexRef.current !== -1 &&\n        isClosing.current === false\n      ) {\n        /**\n         * Set index to new the snap points length, if previous index\n         * is out of bond.\n         */\n        const safeCurrentIndex = Math.min(\n          currentIndexRef.current,\n          snapPoints.length - 1\n        );\n\n        const newSnapPoint = snapPoints[safeCurrentIndex];\n        requestAnimationFrame(() => runOnUI(animateToPoint)(newSnapPoint));\n      }\n    }, [isLayoutCalculated, snapPoints, animateToPoint]);\n\n    /**\n     * handle keyboard appearance behavior\n     */\n    useAnimatedReaction(\n      () => keyboardState.value,\n      (state, previousState) => {\n        if (state === previousState) {\n          return;\n        }\n\n        let animationConfigs = getKeyboardAnimationConfigs(\n          keyboardAnimationEasing.value,\n          keyboardAnimationDuration.value\n        );\n\n        /**\n         * Handle restore sheet position on blur\n         */\n        if (\n          keyboardBlurBehavior === KEYBOARD_BLUR_BEHAVIOR.restore &&\n          state === KEYBOARD_STATE.HIDDEN &&\n          contentPanGestureState.value !== State.ACTIVE &&\n          handlePanGestureState.value !== State.ACTIVE\n        ) {\n          isExtendedByKeyboard.value = false;\n          const newSnapPoint = snapPoints[animatedCurrentIndex.value];\n          animateToPoint(newSnapPoint, 0, animationConfigs);\n        }\n\n        /**\n         * Handle extend behavior\n         */\n        if (\n          keyboardBehavior === KEYBOARD_BEHAVIOR.extend &&\n          state === KEYBOARD_STATE.SHOWN\n        ) {\n          const newSnapPoint = snapPoints[snapPoints.length - 1];\n          animateToPoint(newSnapPoint, 0, animationConfigs);\n          return;\n        }\n\n        /**\n         * Handle full screen behavior\n         */\n        if (\n          keyboardBehavior === KEYBOARD_BEHAVIOR.fullScreen &&\n          state === KEYBOARD_STATE.SHOWN\n        ) {\n          isExtendedByKeyboard.value = true;\n          animateToPoint(topInset, 0, animationConfigs);\n          return;\n        }\n\n        /**\n         * handle interactive behavior\n         */\n        if (\n          keyboardBehavior === KEYBOARD_BEHAVIOR.interactive &&\n          state === KEYBOARD_STATE.SHOWN\n        ) {\n          isExtendedByKeyboard.value = true;\n          const newSnapPoint = snapPoints[snapPoints.length - 1];\n          animateToPoint(\n            Math.max(topInset, newSnapPoint - keyboardHeight.value),\n            0,\n            animationConfigs\n          );\n        }\n      }\n    );\n\n    /**\n     * sets provided animated position\n     */\n    useAnimatedReaction(\n      () => animatedPosition.value,\n      value => {\n        if (_providedAnimatedPosition) {\n          _providedAnimatedPosition.value = value;\n        }\n      }\n    );\n\n    /**\n     * sets provided animated index\n     */\n    useAnimatedReaction(\n      () => animatedIndex.value,\n      value => {\n        if (_providedAnimatedIndex) {\n          _providedAnimatedIndex.value = value;\n        }\n      }\n    );\n\n    /**\n     * reaction to trigger `handleOnChange`\n     */\n    useAnimatedReaction(\n      () => ({\n        _animatedIndex: animatedIndex.value,\n        _animatedPosition: animatedPosition.value,\n        _animationState: animationState.value,\n        _contentGestureState: contentPanGestureState.value,\n        _handleGestureState: handlePanGestureState.value,\n      }),\n      ({\n        _animatedIndex,\n        _animationState,\n        _contentGestureState,\n        _handleGestureState,\n      }) => {\n        if (\n          _animatedIndex % 1 === 0 &&\n          _animationState === ANIMATION_STATE.STOPPED &&\n          (_contentGestureState === State.END ||\n            _contentGestureState === State.UNDETERMINED) &&\n          (_handleGestureState === State.END ||\n            _handleGestureState === State.UNDETERMINED)\n        ) {\n          animatedCurrentIndex.value = animatedIndex.value;\n          runOnJS(handleOnChange)(animatedIndex.value);\n          runOnJS(refreshUIElements)();\n        }\n      },\n      [handleOnChange]\n    );\n    //#endregion\n\n    // render\n    // console.log(\n    //   'BottomSheet',\n    //   'render',\n    //   snapPoints,\n    //   safeContainerHeight,\n    //   safeHandleHeight,\n    //   sheetHeight\n    // );\n    return (\n      <BottomSheetProvider value={externalContextVariables}>\n        <BottomSheetBackdropContainer\n          key=\"BottomSheetBackdropContainer\"\n          animatedIndex={animatedIndex}\n          animatedPosition={animatedPosition}\n          backdropComponent={backdropComponent}\n        />\n        <BottomSheetContainer\n          key=\"BottomSheetContainer\"\n          containerHeight={safeContainerHeight}\n          shouldMeasureHeight={shouldMeasureContainerHeight}\n          onMeasureHeight={handleOnContainerMeasureHeight}\n        >\n          <Animated.View\n            accessible={true}\n            accessibilityRole=\"adjustable\"\n            accessibilityLabel=\"Bottom Sheet\"\n            style={containerStyle}\n          >\n            <BottomSheetInternalProvider value={internalContextVariables}>\n              <BottomSheetBackgroundContainer\n                key=\"BottomSheetBackgroundContainer\"\n                animatedIndex={animatedIndex}\n                animatedPosition={animatedPosition}\n                backgroundComponent={backgroundComponent}\n              />\n              <Animated.View\n                pointerEvents=\"box-none\"\n                style={contentMaskContainerStyle}\n              >\n                {isLayoutCalculated && (\n                  <BottomSheetDraggableView\n                    key=\"BottomSheetRootDraggableView\"\n                    style={contentContainerStyle}\n                  >\n                    {typeof children === 'function'\n                      ? (children as Function)()\n                      : children}\n                  </BottomSheetDraggableView>\n                )}\n              </Animated.View>\n              <BottomSheetHandleContainer\n                key=\"BottomSheetHandleContainer\"\n                animatedIndex={animatedIndex}\n                animatedPosition={animatedPosition}\n                shouldMeasureHeight={shouldMeasureHandleHeight}\n                enableHandlePanningGesture={enableHandlePanningGesture}\n                handlePanGestureHandler={handlePanGestureHandler}\n                handleComponent={handleComponent}\n                snapPoints={snapPoints}\n                onMeasureHeight={handleOnHandleMeasureHeight}\n              />\n            </BottomSheetInternalProvider>\n          </Animated.View>\n          {/* <BottomSheetDebugView\n            values={{\n              animatedIndex,\n              animatedPosition,\n              keyboardState,\n              keyboardHeight,\n              animatedSheetHeight,\n              animatedSheetState,\n              scrollableContentOffsetY,\n              scrollableState,\n              isExtendedByKeyboard,\n            }}\n          /> */}\n        </BottomSheetContainer>\n      </BottomSheetProvider>\n    );\n  }\n);\n\nconst BottomSheet = memo(BottomSheetComponent);\nBottomSheet.displayName = 'BottomSheet';\n\nexport default BottomSheet;\n"]}